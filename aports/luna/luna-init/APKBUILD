pkgname=luna-init
pkgver=5.0.0_git20171117
pkgrel=2
_commit=5fff640fb0b9f3e973c13d1620889b2da4c11766
_artwork_commit="2cad2af027fbec6aef0d1f16226a41ccf427f44e"
pkgdesc="Initialization and font setup files used by luna-sysmgr."
arch="all"
url="http://webos-ports.org"
license="GPL-3.0+"
depends=""
makedepends="cmake-modules-webos python2 py2-tz imagemagick"
source="$pkgname-$_commit.tar.gz::https://github.com/webOS-ports/luna-init/archive/$_commit.tar.gz
postmarketos-artwork-$_artwork_commit.tar.gz::https://github.com/postmarketOS/artwork/archive/${_artwork_commit}.tar.gz"
options="!check"
builddir="$srcdir/$pkgname-$_commit"

prepare() {
	default_prepare
	cd "$srcdir"
	tar xzf postmarketos-artwork-$_artwork_commit.tar.gz
}

build() {
	mkdir -p "$srcdir"/build
	cd "$srcdir"/build
	cmake "$builddir" \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DWEBOS_INSTALL_ROOT=/
	make

	# Convert a wallpaper to jpg. Unfortunately required by luna-next-cardshell.
	# This is done here to remain consistant with the upstream luna-init package which packages the default background image for LuneOS.
	convert "$srcdir"/artwork-"$_artwork_commit"/wallpapers/logo/postmarketos.png "$srcdir"/build/postmarketos.jpg
}

package() {
	cd "$srcdir"/build
	# The cmake install file doesn't install everything in the right spot.
	make DESTDIR="$pkgdir" install

	install -d "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/files/conf/locale.txt "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/files/conf/defaultPreferences.txt "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/src/mccInfo.json "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/files/conf/default-dock-positions.json "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/files/conf/default-launcher-page-layout.json "$pkgdir"/etc/palm
	install -v -m 644 "$builddir"/files/conf/locale.txt "$pkgdir"/etc/palm
	
	# Install a default background image.

	install -d "$pkgdir"/media/internal/wallpapers
	install -v -m 644 "$srcdir"/build/postmarketos.jpg "$pkgdir"/media/internal/wallpapers/LuneOS.jpg

}
sha512sums="9278b53e8358230e0979d314958a02ada6d68a68b97e253d81ffc5132901cf7aa033c8d908530cbf36c422a161a3f80cc70f1ddb3e0e4b3fae86183c39d10b95  luna-init-5fff640fb0b9f3e973c13d1620889b2da4c11766.tar.gz
b86010a33332fe6c3d983e22c982e8edf232bd66d85a4999ecbeb793e24a17c98cb5a51fe476b7a484f79b76908f32d1eae066b7c99cd142f5a810ac46ade163  postmarketos-artwork-2cad2af027fbec6aef0d1f16226a41ccf427f44e.tar.gz"
